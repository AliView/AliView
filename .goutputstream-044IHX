#!/bin/sh

#----------------------------------
#prepare install-file for LINUX
#----------------------------------
# make link to latest version dir (this is what setup-script wants)
#LATEST_LINUX_PATH=$(ls -d /home/anders/maven/AliView/target/linux-version*)
#ln -s -f -T $LATEST_LINUX_PATH /home/anders/maven/AliView/target/linux-latest

rsync -av /home/anders/projekt/maven/AliView/aliview-linux/* /home/anders/maven/AliView/target/linux-version*/aliview/

cd /home/anders/maven/AliView/target/linux-version*/aliview/

makeself . ../aliview.install.run "Installer for AliView" ./install.sh 
makeself . ../aliview.install.run "Installer for AliView" ./install.sh

# make standard archive for linux
tar -czvf ../aliview.tgz *

# move non installer files fo other dir
#mkdir /home/anders/maven/AliView/target/linux-version*/without_installer_version
#mv /home/anders/maven/AliView/target/windows-latest/AliView.exe /home/anders/maven/AliView/target/windows-latest/without_installer_version
#mv /home/anders/maven/AliView/target/windows-latest/aliview.jar /home/anders/maven/AliView/target/windows-latest/without_installer_version

# and linux install instr to server
rsync -av /home/anders/maven/AliView/target/linux-version*/aliview/install.readme.txt /home/anders/maven/AliView/target/linux-version*
rsync -av /home/anders/maven/AliView/htaccess-files/linux-install-dir/.htaccess /home/anders/maven/AliView/target/linux-version*

#----------------------------------
#prepare install-file for WINDOWS
#----------------------------------
# create setup for windows
# make link to latest version dir (this is what setup-script wants)
LATEST_WIN_PATH=$(ls -d /home/anders/maven/AliView/target/windows-version-*)
ln -s -f -T $LATEST_WIN_PATH /home/anders/maven/AliView/target/windows-latest

wine "/home/anders/.wine/drive_c/Program Files/Inno Setup 5/iscc" "Z:\home\anders\maven\AliView\innosetupfil_for_Aliview_win.iss"

# move non installer files fo other dir
mkdir /home/anders/maven/AliView/target/windows-latest/without_installer_version
mv /home/anders/maven/AliView/target/windows-latest/AliView.exe /home/anders/maven/AliView/target/windows-latest/without_installer_version
mv /home/anders/maven/AliView/target/windows-latest/aliview.jar /home/anders/maven/AliView/target/windows-latest/without_installer_version

#----------------------------------
# COPY FILES
#----------------------------------
# copy one version to local
rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/target/windows-version* /home/anders/maven/AliView/deployed/

rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/target/linux-version* /home/anders/maven/AliView/deployed/

rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/target/AliView*-app.zip /home/anders/maven/AliView/deployed/

# and one version to server (including version history)

if grep -q beta "/home/anders/maven/AliView/target/classes/version.properties"; then
   BETA_VERSION="beta/"
fi

rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/target/windows-version* anders@ormbunkar.se:/srv/www/htdocs/aliview/downloads/windows/$BETA_VERSION
rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/src/main/resources/version_history.txt anders@ormbunkar.se:/srv/www/htdocs/aliview/downloads/windows/$BETA_VERSION

rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/target/linux-version* anders@ormbunkar.se:/srv/www/htdocs/aliview/downloads/linux/$BETA_VERSION
rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/src/main/resources/version_history.txt anders@ormbunkar.se:/srv/www/htdocs/aliview/downloads/linux/$BETA_VERSION

rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/target/AliView*-app.zip anders@ormbunkar.se:/srv/www/htdocs/aliview/downloads/mac/$BETA_VERSION
rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/src/main/resources/version_history.txt anders@ormbunkar.se:/srv/www/htdocs/aliview/downloads/mac/$BETA_VERSION

# and another copy of version history do root directory
rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/src/main/resources/version_history.txt anders@ormbunkar.se:/srv/www/htdocs/aliview/

# and file version 
rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/target/classes/version.properties anders@ormbunkar.se:/srv/www/htdocs/aliview/$BETA_VERSION

# copy webpage to server
rsync -av -e 'ssh -i /home/anders/.ssh/id_rsa  -p 64535' /home/anders/maven/AliView/web/* anders@ormbunkar.se:/srv/www/htdocs/aliview/$BETA_VERSION




